# Only run against master
trigger:
- master

# Don't run against PRs
pr: none

variables:
  BuildConfiguration: Release
  WebApp_ProjectName: MinecraftServer.Web
  WebApp_ProjectDirectory: $(Build.SourcesDirectory)/src/$(WebApp_ProjectName)
  WebApp_ProjectFile: $(WebApp_ProjectDirectory)/$(WebApp_ProjectName).csproj

stages:
- stage: build
  jobs:
  - job: run_build
    pool:
      vmImage: 'Ubuntu 16.04'
    steps:

    ## Run the dotnet build/publish
    - script: |
        dotnet build $(WebApp_ProjectFile) --configuration $(BuildConfiguration)
        dotnet publish $(WebApp_ProjectFile) --configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)

    ## Archive the files into a zip file for publishing
    - task: ArchiveFiles@2
      inputs:
        rootFolderOrFile: $(Build.ArtifactStagingDirectory)
        archiveType: 'zip'
        archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
        includeRootFolder: false

    ## Publish the zip file
    - task: PublishBuildArtifacts@1
      inputs:
        pathtoPublish: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'